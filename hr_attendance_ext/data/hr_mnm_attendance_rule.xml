<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">

        <record id="clander_mnm_template" model="resource.calendar">
            <field name="name">MnM Template hours/week</field>
            <field name="tz">Asia/Tehran</field>
        </record>

        <record id="hr_attendance_attendance_mnm_rule" model="hr.attendance.rule">
            <field name="name">حضور</field>
            <field name="code">ATTENDANCE_TYPE</field>
            <field name="work_entry_type_id" ref="work_entry_attendance_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 1</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">1</field>
        </record>

        <record id="hr_attendance_absence_mnm_rule" model="hr.attendance.rule">
            <field name="name">غیبت</field>
            <field name="code">ABSENCE_TYPE</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_absence_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 2</field>
            <field name="start_formula">result = attendance.s_date</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">2</field>
        </record>

        <record id="hr_attendance_takhir_dar_khoroj_mnm_rule" model="hr.attendance.rule">
            <field name="name">تاخیر در خروج</field>
            <field name="code">TAKHIR_DAR_KHOROJ</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_overtime_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 1 and attendance.e_date &gt; shift.end_datetime</field>
            <field name="start_formula">result = max(attendance.s_date, shift.end_datetime)</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">3</field>
        </record>

        <record id="hr_attendance_takhir_dar_vorod_mnm_rule" model="hr.attendance.rule">
            <field name="name">تاخیر در ورود</field>
            <field name="code">TAKHIR_DAR_VOROD</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_kasr_kar_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.s_date &lt; shift.end_datetime and attendance.s_date &gt; shift.start_datetime and (not previous_att  or ( previous_att .e_date &lt; shift.start_datetime)) and attendance.sub_type!= "DAILY_MISSION" </field>
            <field name="start_formula">result = shift.start_datetime</field>
            <field name="end_formula">result = attendance.s_date</field>
            <field name="sequence">4</field>
        </record>

        <record id="hr_attendance_tajil_dar_khoroj_mnm_rule" model="hr.attendance.rule">
            <field name="name">تعجیل در خروج</field>
            <field name="code">TAJIL_DAR_KHOROJ</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_kasr_kar_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.e_date &lt; shift.end_datetime and attendance.e_date &gt; shift.start_datetime and (not next_att or next_att.s_date &gt; shift.end_datetime) and attendance.sub_type!= "DAILY_MISSION" </field>
            <field name="start_formula">result = attendance.e_date</field>
            <field name="end_formula">result = shift.end_datetime</field>
            <field name="sequence">5</field>
        </record>

        <record id="hr_attendance_tajil_dar_vorod_mnm_rule" model="hr.attendance.rule">
            <field name="name">تعجیل در ورود</field>
            <field name="code">TAJIL_DAR_VOROD</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_overtime_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 1 and attendance.s_date &lt; shift.start_datetime</field>
            <field name="start_formula">result = attendance.s_date</field>
            <field name="end_formula">result = min(attendance.e_date, shift.start_datetime)</field>
            <field name="sequence">6</field>
        </record>

        <record id="hr_attendance_absence_during_shift_mnm_rule" model="hr.attendance.rule">
            <field name="name">عدم حضور حین شیفت</field>
            <field name="code">ABSENCE_DURING_SHIFT</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_kasr_kar_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and (shift.start_datetime &lt; attendance.s_date &lt; shift.end_datetime or shift.start_datetime &lt; attendance.e_date &lt; shift.end_datetime) and next_att and next_att.s_date &lt; shift.end_datetime and attendance.sub_type!= "DAILY_MISSION"</field>
            <field name="start_formula">result = attendance.e_date</field>
            <field name="end_formula">result = next_att.s_date</field>
            <field name="sequence">7</field>
        </record>

        <record id="hr_attendance_work_holiday_mnm_rule" model="hr.attendance.rule">
            <field name="name">تعطیل کاری</field>
            <field name="code">WORK_HOLIDAY</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_work_holiday_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = not has_shift and not attendance.s_date.weekday() == 4  and is_holiday and attendance.type == 1</field>
            <field name="start_formula">result = attendance.s_date</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">8</field>
        </record>

        <record id="hr_attendance_work_friday_mnm_rule" model="hr.attendance.rule">
            <field name="name">جمعه کاری</field>
            <field name="code">WORK_FRIDAY</field>
            <field name="work_entry_type_id" ref="work_entry_work_friday_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = not has_shift and attendance.s_date.weekday() == 4  and attendance.type == 1</field>
            <field name="start_formula">result = attendance.s_date</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">9</field>
        </record>

        <record id="hr_attendance_work_night_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">شب کاری</field>
            <field name="code">WORK_NIGHT</field>
            <field name="work_entry_type_id" ref="work_entry_work_night_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = not attendance.s_date.weekday() == 4 and not is_holiday and not has_shift and attendance.type == 1 and attendance.s_date &lt;= night_shift.e_date and attendance.e_date &gt;= night_shift.s_date</field>
            <field name="start_formula">result = max(attendance.s_date, night_shift.s_date)</field>
            <field name="end_formula">result = min(attendance.e_date, night_shift.e_date)</field>
            <field name="sequence">10</field>
        </record>

        <record id="hr_attendance_paid_hourly_time_off_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">مرخصی استحقاقی ساعتی</field>
            <field name="code">PAID_HOURLY_TIME_OFF</field>
            <field name="work_entry_type_id" ref="work_entry_paid_time_off_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 3 and attendance.sub_type == "PAID_HOURLY_TIME_OFF"</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">11</field>
        </record>

        <record id="hr_attendance_unpaid_hourly_time_off_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">مرخصی بدون حقوق</field>
            <field name="code">UNPAID_HOURLY_TIME_OFF</field>
            <field name="work_entry_type_id" ref="work_entry_unpaid_time_off_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 3 and attendance.sub_type == "UNPAID_HOURLY_TIME_OFF"</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">12</field>
        </record>

        <record id="hr_attendance_sick_time_off_work_mnm_work" model="hr.attendance.rule">
            <field name="name">مرخصی استعلاجی</field>
            <field name="code">SICK_TIME_OFF</field>
            <field name="work_entry_type_id" ref="work_entry_sick_time_off_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 3 and attendance.sub_type == "SICK_TIME_OFF"</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">13</field>
        </record>

        <record id="hr_attendance_maternity_time_off_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">مرخصی زایمان</field>
            <field name="code">MATERNITY_TIME_OFF</field>
            <field name="work_entry_type_id" ref="work_entry_maternity_time_off_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 3 and attendance.sub_type == "MATERNITY_TIME_OFF"</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">14</field>
        </record>

        <record id="hr_attendance_fdr_death_time_off_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">مرخصی فوت اعضا درجه یک</field>
            <field name="code">FDR_DEATH_TIME_OFF</field>
            <field name="work_entry_type_id" ref="work_entry_fdr_death_time_off_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 3 and attendance.sub_type == "FDR_DEATH_TIME_OFF"</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">15</field>
        </record>

        <record id="hr_attendance_marriage_time_off_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">مرخصی ازدواج</field>
            <field name="code">MARRIAGE_TIME_OFF</field>
            <field name="work_entry_type_id" ref="work_entry_marriage_time_off_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = has_shift and attendance.type == 3 and attendance.sub_type == "MARRIAGE_TIME_OFF"</field>
            <field name="start_formula">result = max(attendance.s_date, shift.start_datetime)</field>
            <field name="end_formula">result = min(attendance.e_date, shift.end_datetime)</field>
            <field name="sequence">16</field>
        </record>

        <record id="hr_attendance_daily_mission_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">ماموریت روزانه</field>
            <field name="code">DAILY_MISSION</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_daily_mission_work_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = attendance.type == 4 and attendance.sub_type == "DAILY_MISSION"</field>
            <field name="start_formula">result = attendance.s_date</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">17</field>
        </record>

        <record id="hr_attendance_hourly_mission_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">ماموریت ساعتی</field>
            <field name="code">HOURLY_MISSION</field>
            <field name="work_entry_type_id" ref="work_entry_attendance_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = attendance.type == 4 and attendance.sub_type == "HOURLY_MISSION"</field>
            <field name="start_formula">result = attendance.s_date</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">18</field>
        </record>

        <record id="hr_attendance_hozor_kh_ghabl_shab_work_mnm_rule" model="hr.attendance.rule">
            <field name="name">حضور خارج از شیفت (قبل شبکاری)</field>
            <field name="code">HOZOR_KH_GHABL_SHAB</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_overtime_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = not attendance.s_date.weekday() == 4 and not has_shift and not is_holiday and attendance.type == 1 and attendance.s_date &lt; night_shift.s_date</field>
            <field name="start_formula">result = min(attendance.s_date, night_shift.s_date)</field>
            <field name="end_formula">result = min(attendance.e_date, night_shift.s_date )</field>
            <field name="sequence">19</field>
        </record>

        <record id="hr_attendance_hozor_kh_bad_shab_mnm_rule" model="hr.attendance.rule">
            <field name="name">حضور خارج از شیفت (بعد شبکاری)</field>
            <field name="code">HOZOR_KH_BAD_SHAB</field>
            <field name="work_entry_type_id" ref="hr_payroll_ext.work_entry_overtime_type"/>
            <field name="resource_calendar_id" ref="clander_mnm_template"/>
            <field name="condition_formula">result = not attendance.s_date.weekday() == 4 and not has_shift and not is_holiday and attendance.type == 1 and attendance.e_date &gt; night_shift.e_date</field>
            <field name="start_formula">result = max(attendance.s_date, night_shift.e_date)</field>
            <field name="end_formula">result = attendance.e_date</field>
            <field name="sequence">20</field>
        </record>

    </data>
</odoo>

