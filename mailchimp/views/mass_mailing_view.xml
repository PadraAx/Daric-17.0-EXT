<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="view_mail_mass_mailing_form" model="ir.ui.view">
            <field name="name">mailing.mailing.form</field>
            <field name="model">mailing.mailing</field>
            <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='mailing_model_id']" position="attributes">
                    <attribute name="readonly">mailchimp_template_id or 'state' in ('sending', 'done')</attribute>
<!--                    <attribute name="attrs">{'readonly': ['|', ('mailchimp_template_id', '!=', False), ('state', 'in', ('sending', 'done'))]}</attribute>-->
                </xpath>

                <!--This field values get from onchange mailchimp template so we can filter mailing list-->
                <xpath expr="//label[@for='mailing_model_id']" position="before">
                    <field name="mailchimp_mailing_list_ids" invisible="1"/>
                </xpath>
                <field name="contact_list_ids" widget="many2many_tags" position="attributes">
                    <attribute name="domain">[('id', 'in', mailchimp_mailing_list_ids)]</attribute>
                </field>

                <xpath expr="//sheet/group[1]" position="inside">
                    <label for="mailchimp_template_id" string="MailChimp Template"/>
                    <div>
                        <field name="mailchimp_template_id" nolabel="1" readonly="state in ('sending', 'done')"/>
                    </div>
                    <label for="mailchimp_segment_id" invisible="not mailchimp_template_id"/>
                    <div>
                        <field name="mailchimp_list_id" invisible="1"/>
                        <field name="mailchimp_segment_id" nolabel="1" domain="[('list_id','=', mailchimp_list_id)]"
                               readonly="state in ('sending', 'done')" invisible="not mailchimp_template_id"/>
                    </div>
                    <!--                    Type of camp. We are passing static when send via mailchimp-->
                    <!--                    <label for="mailchimp_champ_type" string="Type" attrs="{'required':[('mailchimp_template_id','!=',False)], 'invisible' : [('mailchimp_template_id','=',False)]}"/>-->
                    <!--                    <div>-->
                    <!--                        <field name="mailchimp_champ_type" nolabel="1" attrs="{'required':[('mailchimp_template_id','!=',False)], 'invisible' : [('mailchimp_template_id','=',False)]}"/>-->
                    <!--                    </div>-->
                </xpath>
                <field name="body_arch" position="attributes">
                    <attribute name="invisible">mailchimp_template_id</attribute>
                    <attribute name="readonly">state in ('sending', 'done')</attribute>
<!--                    <attribute name="attrs">{'invisible': [('mailchimp_template_id', '!=', False)], 'readonly': [('state', 'in', ('sending', 'done'))]}</attribute>-->
                </field>
                <!-- Show selected template design in campaigns -->
                <xpath expr="//sheet/notebook/page[@name='mail_body']" position="inside">
                    <field name="mailchimp_body_arch" class="o_mail_body" nolabel="1" widget="mass_mailing_html" force_save="1"
                           invisible="not mailchimp_template_id or not mailchimp_body_arch"
                           readonly="1"/>
                </xpath>
                <div name="button_box" position="inside">
                    <button class="oe_stat_button" type="action" name="%(mailchimp.action_mailchimp_queue_process)d"
                            context="{'search_default_campaign_id': [active_id]}"
                            invisible="pending_queue_count == 0" icon="fa-server">
                        <field string="Queue" name="pending_queue_count" widget="statinfo"/>
                    </button>
                </div>
            </field>
        </record>

        <record id="mailing_mailing_view_form_full_width" model="ir.ui.view">
            <field name="name">mailing.mailing.view.form.full.width</field>
            <field name="model">mailing.mailing</field>
            <field name="inherit_id" ref="mass_mailing.mailing_mailing_view_form_full_width"/>
            <field name="arch" type="xml">
                <field name="is_body_empty" position="after">
                    <field name="mailchimp_template_id" invisible="1"/>
                </field>
                <field name="body_html" position="attributes">
                    <attribute name="invisible">mailchimp_template_id</attribute>
<!--                    <attribute name="attrs">{'invisible': [('mailchimp_template_id', '!=', False)]}</attribute>-->
                </field>
                <xpath expr="//div[hasclass('o_view_nocontent')]" position="attributes">
                    <attribute name="invisible">mailchimp_template_id or not is_body_empty or state in ('sending', 'done')</attribute>
<!--                    <attribute name="attrs">{'invisible': ['|', ('mailchimp_template_id', '!=', False), '|', ('is_body_empty', '=', False), ('state', 'in', ('sending', 'done'))]}-->
<!--                    </attribute>-->
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="mailing_mailing_view_search_mailchimp">
            <field name="name">mailing.mailing.search.mailchimp.view</field>
            <field name="model">mailing.mailing</field>
            <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_search"/>
            <field name="arch" type="xml">
                <filter name="assigned_to_me" position="after">
                    <filter string="MailChimp Campaign" name="mailchimp_campaign" domain="[('mailchimp_id', '!=', False)]"/>
                </filter>
            </field>
        </record>

        <record id="view_mail_mass_mailing_kanban" model="ir.ui.view">
            <field name="name">mailing.mailing.kanban</field>
            <field name="model">mailing.mailing</field>
            <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_kanban"/>
            <field name="arch" type="xml">
                <field name="color" position="after">
                    <field name="mailchimp_id"/>
                </field>
                <xpath expr="//div[hasclass('o_kanban_record_headings')]/h3" position="after">
                    <t t-if="record.mailchimp_id.raw_value">
                        <span class="badge rounded-pill text-bg-primary">
                            MailChimp
                        </span>
                    </t>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
